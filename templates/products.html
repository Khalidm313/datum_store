{% extends "base.html" %}

{% block content %}
<style>
    /* تنسيق شريط البحث */
    .search-card {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 25px;
        border: 1px solid #e2e8f0;
    }
    
    .search-form {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .search-input {
        flex: 1; /* يأخذ باقي المساحة */
        padding: 12px 15px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: 0.2s;
    }
    
    .search-input:focus {
        border-color: #2563eb;
        outline: none;
    }

    .btn-search {
        background: #2563eb;
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: 0.2s;
    }
    
    .btn-search:hover { background: #1d4ed8; }

    .btn-clear {
        background: #ef4444;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: bold;
    }

    /* تنسيق الجدول */
    .table-container {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        overflow: hidden;
        border: 1px solid #e2e8f0;
    }
    
    table { width: 100%; border-collapse: collapse; }
    th { background: #f8fafc; padding: 15px; text-align: right; border-bottom: 1px solid #e2e8f0; color: #475569; }
    td { padding: 15px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
    tr:last-child td { border-bottom: none; }

    /* المودال */
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
    .modal-content { background: #fff; margin: 5% auto; padding: 30px; border-radius: 12px; width: 500px; position: relative; }
</style>

<div class="page-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h1 class="page-title" style="margin: 0;">إدارة المنتجات</h1>
    <button onclick="openModal()" class="btn" style="background: #2563eb; color: white; padding: 10px 20px; border-radius: 8px; border:none; cursor:pointer;">
        <i class="fas fa-plus"></i> منتج جديد
    </button>
</div>

<div class="search-card">
    <form method="GET" action="{{ url_for('products') }}" class="search-form">
        <input type="text" name="search_ref" class="search-input" 
               placeholder="اكتب الرقم الإشاري (الباركود) هنا..." 
               value="{{ request.args.get('search_ref', '') }}" autofocus>
        
        <button type="submit" class="btn-search">
            <i class="fas fa-search"></i> بحث
        </button>

        {% if request.args.get('search_ref') %}
        <a href="{{ url_for('products') }}" class="btn-clear">
            <i class="fas fa-times"></i> إلغاء
        </a>
        {% endif %}
    </form>
</div>

<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>المنتج</th>
                <th>الباركود</th>
                <th>القسم</th>
                <th>المخزون</th>
                <th>سعر الشراء</th>
                <th>سعر البيع</th>
                <th style="text-align: center;">إجراءات</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td style="font-weight: bold;">{{ product.name }}</td>
                <td style="font-family: monospace; color: #64748b;">{{ product.barcode or '-' }}</td>
                <td><span style="background: #e0f2fe; color: #0369a1; padding: 3px 10px; border-radius: 20px; font-size: 0.85rem;">{{ product.category }}</span></td>
                <td>
                    {% if product.stock <= 5 %}
                        <span style="color: #ef4444; font-weight: bold;">{{ product.stock }} (منخفض)</span>
                    {% else %}
                        <span style="color: #10b981; font-weight: bold;">{{ product.stock }}</span>
                    {% endif %}
                </td>
                <td>{{ product.buy_price }}</td>
                <td style="font-weight: bold; color: #2563eb;">{{ product.sell_price }}</td>
                <td style="text-align: center;">
                    <a href="{{ url_for('edit_product', id=product.id) }}" style="color: #64748b; margin-left: 10px; font-size: 1.1rem;"><i class="fas fa-edit"></i></a>
                    <a href="{{ url_for('delete_product', id=product.id) }}" onclick="return confirm('حذف؟')" style="color: #ef4444; font-size: 1.1rem;"><i class="fas fa-trash"></i></a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" style="text-align: center; padding: 40px; color: #94a3b8;">
                    <i class="fas fa-search fa-3x" style="margin-bottom: 15px; display: block; opacity: 0.3;"></i>
                    لا توجد منتجات مطابقة للبحث
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div id="productModal" class="modal">
    <div class="modal-content">
        <span onclick="document.getElementById('productModal').style.display='none'" style="position: absolute; left: 20px; top: 20px; cursor: pointer; font-size: 1.5rem;">&times;</span>
        <h2 style="margin-top: 0; margin-bottom: 20px;">إضافة منتج جديد</h2>
        
        <form method="POST" style="display: grid; gap: 15px;">
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">اسم المنتج</label>
                <input type="text" name="name" class="form-control" required style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">الباركود</label>
                    <input type="text" name="barcode" class="form-control" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">القسم</label>
                    <input type="text" name="category" list="catList" class="form-control" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
                    <datalist id="catList">
                        <option value="عام">
                        <option value="إلكترونيات">
                        <option value="ملابس">
                    </datalist>
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">سعر الشراء</label>
                    <input type="number" step="0.01" name="buy_price" class="form-control" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">سعر البيع</label>
                    <input type="number" step="0.01" name="sell_price" class="form-control" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
                </div>
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">المخزون</label>
                <input type="number" name="stock" class="form-control" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
            </div>
            
            <button type="submit" style="background: #2563eb; color: white; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 10px;">حفظ المنتج</button>
        </form>
    </div>
</div>

<script>
    function openModal() { document.getElementById('productModal').style.display = 'block'; }
    
    window.onclick = function(e) {
        if (e.target == document.getElementById('productModal')) {
            document.getElementById('productModal').style.display = 'none';
        }
    }
</script>
{% endblock %}